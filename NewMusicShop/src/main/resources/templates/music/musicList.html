<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ğŸ· NewMusic ë¦¬ìŠ¤íŠ¸</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
  <style>
    body {
      background: #f2f2f2;
      font-family: 'Segoe UI', sans-serif;
    }

    .container {
      margin-top: 50px;
    }

    .music-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 3px 10px rgba(0, 0, 0, 0.08);
      padding: 15px;
      margin-bottom: 20px;
      transition: 0.3s;
    }

    .music-card:hover {
      transform: scale(1.02);
    }

    .title {
      font-size: 1.2rem;
      font-weight: 600;
    }

    .artist {
      font-size: 1rem;
      color: #777;
    }

    .price {
      font-size: 1.1rem;
      color: #17a2b8;
    }

    .album-img {
      max-width: 100%;
      max-height: 120px;
      border-radius: 8px;
      margin-bottom: 5px;
    }

    .btn-buy {
      margin-top: 10px;
      font-size: 0.9rem;
      font-weight: bold;
      background: linear-gradient(to right, #ff6a00, #ee0979);
      border: none;
      color: white;
      border-radius: 25px;
      padding: 8px 20px;
      transition: 0.3s;
    }

    .btn-buy:hover {
      transform: scale(1.05);
      background: linear-gradient(to right, #ee0979, #ff6a00);
    }

    .list-group-item {
      cursor: pointer;
      transition: 0.2s;
    }

    .list-group-item:hover {
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>


<div class="container">
  <div class="text-right mb-4">
    <a href="/" class="btn btn-secondary">â¬… ë©”ì¸ìœ¼ë¡œ ê°€ê¸°</a>
  </div>

  <h2 class="text-center mb-4">ğŸ· ìŒì•… ë¦¬ìŠ¤íŠ¸</h2>

  <div class="row">
    <!-- ì¢Œì¸¡ ì¹´í…Œê³ ë¦¬ -->
    <div class="col-md-3 mb-4">
      <div class="bg-white p-3 rounded shadow-sm">
        <h5 class="mb-3">ğŸ¼ ì¹´í…Œê³ ë¦¬</h5>
        <ul class="list-group">
          <li class="list-group-item">ğŸ§ ì „ì²´</li>
          <li class="list-group-item">ğŸ¸ ë½</li>
          <li class="list-group-item">ğŸ¹ ì¬ì¦ˆ</li>
          <li class="list-group-item">ğŸ¤ ë°œë¼ë“œ</li>
          <li class="list-group-item">ğŸ® ê²Œì„ìŒì•…</li>
        </ul>
      </div>
    </div>

    <!-- ìš°ì¸¡ ìŒì•… ë¦¬ìŠ¤íŠ¸ -->
    <div class="col-md-9">
      <div id="music-container"></div>

      <div class="text-left mt-4">
        <a href="/nft/list" class="btn btn-info">ğŸ· ê·¸ë¦¼ ë§ˆì¼“ìœ¼ë¡œ</a>
      </div>
    </div>
  </div>
</div>

<!-- âœ… PortOne ê²°ì œ SDK -->
<script src="https://cdn.iamport.kr/js/iamport.payment-1.2.0.js"></script>

<script th:inline="javascript">
  const isLoggedIn = /*[[${loginUser != null}]]*/ true;
</script>

<script>
  const clientKey = "test_ck_channel-key-986221b0-b5cd-401f-8606-c781aeb14b5d"; // ì‹¤ì œ í´ë¼ì´ì–¸íŠ¸ í‚¤

  const musicList = [
	  {
		    musicNo: 1,
		    title: "Test Track",   // âœ… DB ê°’ê³¼ ë§ì¶¤
		    artist: "Test Artist", // âœ… DB ê°’ê³¼ ë§ì¶¤
		    price: 1100,
		    imagePath: "/upload/img/sample1.jpg", // ê°€ëŠ¥í•˜ë©´ ì ˆëŒ€ê²½ë¡œ ë§ê³  DBì— ì €ì¥ëœ ê°’ ì¨ë¼
		    iframe: `<iframe ...></iframe>`
		  },
	  {
	    musicNo: 2,
	    title: "Track #1",
	    artist: "Artist 1",
	    price: 1100,
	    imagePath: "https://search.pstatic.net/common/?src=http%3A%2F%2Fblogfiles.naver.net%2FMjAyMTAxMDNfOTIg%2FMDAxNjA5NjQ2ODU5MzEx.JS8D1AyG0V2lALiTyWPx7jlBzFFwREqaY3WMYmbeORQg.EQBJ5ceKNC1WINlKEC5RxT5dDia6y1w9GQtuGiAaAZEg.PNG.kjoo234%2F20210102_173734.png&type=a340",
	    iframe: `<iframe width='100%' height='166' scrolling='no' frameborder='no' allow='autoplay' src='https://w.soundcloud.com/player/?url=https%3A//soundcloud.com/michael-jackson-881677963/billie-jean-audio-oficial-1&color=%230066cc&auto_play=false&show_artwork=true'></iframe>`
	  },
	  {
	    musicNo: 2,
	    title: "Track #2",
	    artist: "Artist 2",
	    price: 1200,
	    imagePath: "https://search.pstatic.net/common/?src=http%3A%2F%2Fimgnews.naver.net%2Fimage%2F408%2F2024%2F11%2F18%2F0000242773_017_20241118005501784.JPG&type=a340",
	    iframe: `<iframe width='100%' height='166' scrolling='no' frameborder='no' allow='autoplay' src='https://w.soundcloud.com/player/?url=https%3A//soundcloud.com/unbmxoi7wjmj/sets/tgcjaslcftrz&color=%230066cc&auto_play=false&show_artwork=true'></iframe>`
	  },
	  {
	    musicNo: 3,
	    title: "Track #3",
	    artist: "Artist 3",
	    price: 1300,
	    imagePath: "https://search.pstatic.net/common/?src=http%3A%2F%2Fimgnews.naver.net%2Fimage%2F213%2F2024%2F04%2F24%2F0001293363_001_20240424182001547.jpg&type=sc960_832",
	    samplePath: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3"
	  },
	  {
	    musicNo: 4,
	    title: "Lost Melody",
	    artist: "Nova Echo",
	    price: 1500,
	    imagePath: "https://picsum.photos/id/1010/300/200",
	    samplePath: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-3.mp3"
	  },
	  
	  {
	    musicNo: 6,
	    title: "Night Walk",
	    artist: "MoonChild",
	    price: 1600,
	    imagePath: "https://picsum.photos/id/1012/300/200",
	    samplePath: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-4.mp3"
	  },
	  {
	    musicNo: 7,
	    title: "Rainy Days",
	    artist: "Soul Vibe",
	    price: 1800,
	    imagePath: "https://picsum.photos/id/1013/300/200",
	    samplePath: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-5.mp3"
	  },
	  {
	    musicNo: 8,
	    title: "Sunset Lover",
	    artist: "Chill Light",
	    price: 1450,
	    imagePath: "https://picsum.photos/id/1014/300/200",
	    samplePath: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-6.mp3"
	  },
	  {
	    musicNo: 9,
	    title: "Digital Love",
	    artist: "RetroWave",
	    price: 1550,
	    imagePath: "https://picsum.photos/id/1015/300/200",
	    samplePath: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-7.mp3"
	  },
	  {
	    musicNo: 10,
	    title: "Soul Sketch",
	    artist: "Neo Jazz",
	    price: 1650,
	    imagePath: "https://picsum.photos/id/1016/300/200",
	    samplePath: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-8.mp3"
	  }
  // ... ìƒëµ ê°€ëŠ¥
];




const container = document.getElementById("music-container");

function startPayment(musicNo, title, price, artist) {
	  var IMP = window.IMP;
	  IMP.init("imp37364400"); // ğŸ’³ PortOne ê°€ë§¹ì  ì‹ë³„ì½”ë“œ ( ì „ìš©)

	  IMP.request_pay({
	    pg: "uplus",                 // âœ… ì‹¤ì œ PortOne ì½˜ì†”ì— ë“±ë¡ëœ PGì‚¬ ì½”ë“œ (ì˜ˆ: uplus, html5_inicis ë“±)
	    pay_method: "card",          // ğŸ’³ ê²°ì œ ë°©ì‹ (card, vbank, phone ë“± ê°€ëŠ¥)
	    merchant_uid: "order_" + Date.now(), // ğŸ†” ì£¼ë¬¸ ê³ ìœ ë²ˆí˜¸ (ì¤‘ë³µë˜ë©´ ì•ˆ ë¨)
	    name: `${title} - ${artist}`, // ğŸµ ê²°ì œ ìƒí’ˆëª… (ìŒì› ì œëª© + ì•„í‹°ìŠ¤íŠ¸ ì´ë¦„)
	    amount: Number(price),       // ğŸ’° ê²°ì œ ê¸ˆì•¡ (Numberë¡œ ë³€í™˜ í•„ìˆ˜)
	    buyer_name: "ë®¤ì§",          // ğŸ‘¤ êµ¬ë§¤ì ì´ë¦„ (í…ŒìŠ¤íŠ¸ìš©ìœ¼ë¡œ ê³ ì • ê°€ëŠ¥)
	    popup: true  // âœ… iframe íƒˆì¶œ ë°©ì§€
	    // m_redirect_urlì€ ì“°ì§€ ë§ê³ 

	  }, function (rsp) {
		  if (rsp.success) {
		    // âœ… ì„¸ì…˜ ìœ ì§€ëœ ìƒíƒœì—ì„œ ì´ë™ ê°€ëŠ¥
		    location.href = `/pay/success?musicNo=${musicNo}`;
		  } else {
		    alert("ê²°ì œ ì‹¤íŒ¨: " + rsp.error_msg);
		  }
		});wpwp
	}


musicList.forEach(m => {
  const div = document.createElement("div");
  div.className = "music-card row";

  const audioOrIframe = m.iframe || `
    <audio controls style='width:100%; margin-top:10px;'>
      <source src="${m.samplePath}" type="audio/mpeg" />
    </audio>`;

  const btnHtml = isLoggedIn
    ? `<button class="btn btn-buy" onclick="startPayment(${m.musicNo}, '${m.title}', ${m.price}, '${m.artist}')">
          ğŸ›’ êµ¬ë§¤í•˜ê¸°
       </button>`
    : `<button type="button" class="btn btn-buy" onclick="alert('ë¡œê·¸ì¸ì´ í•„ìš”í•©ë‹ˆë‹¤. ë¡œê·¸ì¸ í›„ ì´ìš©í•´ì£¼ì„¸ìš”.')">
          ğŸ›’ êµ¬ë§¤í•˜ê¸°
       </button>`;

  div.innerHTML = `
    <div class="col-md-3 text-center">
      <img src="${m.imagePath}" class="album-img" alt="cover">
    </div>
    <div class="col-md-5">
      <div class="title">${m.title}</div>
      <div class="artist">by ${m.artist}</div>
      <div class="price">â‚© ${m.price}</div>
      ${audioOrIframe}
    </div>
    <div class="col-md-4 text-center">
      ${btnHtml}
    </div>
  `;

  container.appendChild(div);
});
</script>




</body>
<!-- ğŸ“¢ êµ¬ë§¤ ì™„ë£Œ alert ì¶œë ¥ -->
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const urlParams = new URLSearchParams(window.location.search);
    const alertMsg = urlParams.get("alertMsg");
    if (alertMsg) {
      alert(decodeURIComponent(alertMsg));
    }
  });
</script>
</html>
